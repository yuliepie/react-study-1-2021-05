## ContextAPI ë€?

React ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ëª…ì‹œì ì¸ ë¶€ëª¨-ìì‹ê°„ì˜ Props ì „ë‹¬ ê³¼ì • ì—†ì´ ì–´ë–¤ íŠ¸ë¦¬ì˜ ì»´í¬ë„ŒíŠ¸ ì—ì„œë“  ì´ ê°’ì„ ê³µìœ í•´ì„œ ì“¸ ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” API

## ì–¸ì œ, ì™œ ì“°ëŠ” ê±¸ê¹Œ

ê°’ì„ Root â‡’ A â‡’ B â‡’ F ì´ë ‡ê²Œ ë‚´ë ¤ì£¼ëŠ” ê³¼ì •ì´ ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ìƒë‹¹íˆ ë§ì´ í•„ìš”í•œ ê³¼ì •. ( ì „ì—­ì ìœ¼ë¡œ ë‹¤ë£¨ëŠ” cssí…Œë§ˆ, ìœ ì € ì •ë³´, ì–¸ì–´ì •ë³´ ë“±...)  
ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì»´í¬ë„ŒíŠ¸ì˜ ê¹Šì´ê°€ êµ‰ì¥íˆ ê¹Šì„ ìˆ˜ë„ ìˆê³ , ë‹¤ë£¨ê²Œ ë˜ëŠ” ë°ì´í„°ë“¤ë„ í›¨ì”¬ ë§ì•„ì§ˆ ìˆ˜ë„ ìˆì–´  
ìœ ì§€ë³´ìˆ˜ì„±ì„ ê³ ë ¤í•˜ì—¬ **ì „ì—­ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°’ë“¤ì„ ì €ì¥í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì§„ API**ì…ë‹ˆë‹¤.

ì›ë˜ëŠ” Redux, MobXì™€ ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ê²Œ ë¬ì—ˆëŠ”ë° í˜„ì¬ëŠ” ContextAPIë¥¼ ì´ìš©í•˜ì—¬ ê¸€ë¡œë²Œ ìƒíƒœ ê´€ë¦¬ë¥¼ ì‰½ê²Œ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

![contextAPI01](resources/images/contextAPI01.png)

[Context - React](https://ko.reactjs.org/docs/context.html#when-to-use-context)

## APIë“¤

### React.createContext

**_Context ê°ì²´ë¥¼ ë§Œë“­ë‹ˆë‹¤._**

```jsx
const MyContext = React.createContext(defaultValue);

ì„ ì–¸ëœ ë³€ìˆ˜ -> ì´ ê°’ìœ¼ë¡œ contextê°ì²´ì—ì„œ ê°’ì„ ì°¾ì„ ìˆ˜ ìˆë‹¤.
defaultValue -> íŠ¸ë¦¬ì•ˆì—ì„œ ì ì ˆí•œ Providerë¥¼ ì°¾ì§€ ëª»í–ˆì„ ë•Œ ì“°ì´ëŠ” ê°’.
```

Context.Providerë¡œ ì»´í¬ë„ŒíŠ¸ë¥¼ ê°ì‹¸ë©´ í•˜ìœ„ íŠ¸ë¦¬ë“¤ì€ ì´ Contextê°ì²´ë¥¼ êµ¬ë…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

êµ¬ë…ì‹œì—ëŠ” **Consumerê°ì²´ë‚˜ useContextë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤**.

defaultValueëŠ” íŠ¸ë¦¬ì•ˆì—ì„œ ì ì ˆí•œ Providerë¥¼ ì°¾ì§€ ëª»í–ˆì„ ë–„ë§Œ ì“°ì´ëŠ” ê°’ì…ë‹ˆë‹¤.  
Providerë¥¼ í†µí•´ undefinedë¥¼ ê°’ìœ¼ë¡œ ë³´ë‚¸ë‹¤ê³  í•´ë„ êµ¬ë… ì»´í¬ë„ŒíŠ¸ë“¤ì´ defaultValue ë¥¼ ì½ì§€ëŠ” ì•ŠëŠ”ë‹¤ëŠ” ì ì— ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

### Context.Provider

**_í•˜ìœ„ì— ìˆëŠ” ì»´í¬ë„ŒíŠ¸ì—ê²Œ valueë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆë„ë¡ ê°ì‹¸ì¤ë‹ˆë‹¤._**

```jsx
<MyContext.Provider value={/* ì–´ë–¤ ê°’ */}>
{/* í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë“¤ì—ê²Œ value propìœ¼ë¡œ ê°’ì„ ì „ë‹¬í•©ë‹ˆë‹¤.*/}
```

Context ì˜¤ë¸Œì íŠ¸ì— í¬í•¨ëœ React ì»´í¬ë„ŒíŠ¸ì¸ **ProviderëŠ” contextë¥¼ êµ¬ë…í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì—ê²Œ contextì˜ ë³€í™”ë¥¼ ì•Œë¦¬ëŠ” ì—­í• **ì„ í•©ë‹ˆë‹¤.

Provider ì»´í¬ë„ŒíŠ¸ëŠ” value propì„ ë°›ì•„ì„œ ì „ë‹¬í•©ë‹ˆë‹¤.  
ë˜ Provider í•˜ìœ„ì— ë‹¤ë¥¸ Providerë¥¼ ë°°ì¹˜í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë©°, í•˜ìœ„ Providerë“¤ì˜ ê°’ì´ ìš°ì„ ì‹œë©ë‹ˆë‹¤.  
Providerí•˜ìœ„ì—ì„œ contextë¥¼ êµ¬ë…í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ëŠ” value propì´ ë°”ë€” ë•Œë§ˆë‹¤ ë‹¤ì‹œ ë Œë”ë§ ë©ë‹ˆë‹¤.  
Providerë¡œ ë¶€í„° í•˜ìœ„ consumer (contextì˜ ë³€í™”ë¥¼ êµ¬ë…í•˜ëŠ” ì»´í¬ë„ŒíŠ¸) ë¡œì˜ ì „íŒŒì‹œ shouldComponentUpdateê°€ ë¬´ì‹œë˜ì–´ shouldComponentUpdate ìƒëª…ì£¼ê¸°ì—ì„œ falseë¥¼ ì„ ì–¸í•˜ë”ë¼ë„, í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ëŠ” ë¬´ì¡°ê±´ ì—…ë°ì´íŠ¸ê°€ ë˜ë„ë¡ êµ¬í˜„ì´ ë˜ì–´ìˆìŠµë‹ˆë‹¤. **ë•Œë¬¸ì— ë¬´ì¡°ê±´ consumerê°€ ì—…ë°ì´íŠ¸ ë©ë‹ˆë‹¤.**

### Class.contextType

**React.createContext()ë¡œ ìƒì„±í•œ Context ê°ì²´ë¥¼ ì›í•˜ëŠ” í´ë˜ìŠ¤ì˜ contextType í”„ë¡œí¼í‹°ë¡œ ì§€ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
class ì»´í¬ë„ŒíŠ¸ ì•ˆì—ì„œ this.contextë¥¼ ì´ìš©í•´ í•´ë‹¹ contextì˜ Providerë¥¼ ì°¾ì•„ ê·¸ ê°’ì„ ì½ì„ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.  
_ë‹¤ë§Œ, ì´ APIë¥¼ ì‚¬ìš©ì‹œì—ëŠ” í•˜ë‚˜ì˜ contextë§Œ êµ¬ë…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤._  
ì—¬ëŸ¬ contextë¥¼ êµ¬ë…í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì‹ìœ¼ë¡œ êµ¬í˜„í•˜ê²Œ ë©ë‹ˆë‹¤.

```javascript
// ê¸°ë³¸ê°’ì´ lightì¸  ThemeContext
const ThemeContext = React.createContext("light");

// ë¡œê·¸ì¸í•œ ìœ ì € ì •ë³´ë¥¼ ë‹´ëŠ” UserContext
const UserContext = React.createContext({
  name: "Guest",
});

class App extends React.Component {
  render() {
    const { signedInUser, theme } = this.props;

    // context ì´ˆê¸°ê°’ì„ ì œê³µí•˜ëŠ” App ì»´í¬ë„ŒíŠ¸
    return (
      <ThemeContext.Provider value={theme}>
        <UserContext.Provider value={signedInUser}>
          <Layout />
        </UserContext.Provider>
      </ThemeContext.Provider>
    );
  }
}

// ========== App ì˜ ë‹¤ìŒ ë‹¨ê³„ì˜ ì»´í¬ë„ŒíŠ¸
function Layout() {
  return (
    <div>
      <Sidebar />
      <Content />
    </div>
  );
}

// ========== Layoutì˜ ë‹¤ìŒ ë²ˆì§¸ì˜ ìµœí•˜ìœ„ ì»´í¬ë„ŒíŠ¸
// ì—¬ëŸ¬ contextì˜ ê°’ì„ ë°›ëŠ” ì»´í¬ë„ŒíŠ¸
// Consumerê°ì²´ë¥¼ ì—¬ëŸ¬ ê°œë¥¼ ë§Œë“¤ì–´ ì—¬ëŸ¬ contextë¥¼ êµ¬ë…í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
function Content() {
  return (
    <ThemeContext.Consumer>
      {(theme) => (
        <UserContext.Consumer>
          {(user) => <ProfilePage user={user} theme={theme} />}
        </UserContext.Consumer>
      )}
    </ThemeContext.Consumer>
  );
}

//======== useContextë¥¼ ì‚¬ìš©í•˜ì—¬ ë‘ ê°œì˜ Context ê°ì²´ êµ¬ë… êµ¬í˜„í•˜ê¸°
function Content() {
  const user = useContext(UserContext);
  const theme = useContext(ThemeContext);
  return (
    <>
      <ProfilePage user={user} theme={theme} />
    </>
  );
}
```

### Context.Consumer

contextì˜ ë³€í™”ë¥¼ êµ¬ë…í•˜ëŠ” React ì»´í¬ë„ŒíŠ¸.   
í˜„ì¬ useContextë¥¼ ì´ìš©í•´ ì¢€ ë” ê°„ë‹¨í•˜ê³  ëª…ë£Œí•˜ê²Œ í‘œí˜„í•  ìˆ˜ ìˆë‹¤ê³  í•©ë‹ˆë‹¤. [ì°¸ê³ ë§í¬](https://stackoverflow.com/questions/56816374/context-consumer-vs-usecontext-to-access-values-passed-by-context-provider)     

```jsx
<MyContext.Consumer>
  {value => /* context ê°’ì„ ì´ìš©í•œ ë Œë”ë§
	ì´ íŒŒë¼ë¯¸í„°ê°€ contextì˜ í˜„ì¬ ê°’ì„ ì˜ë¯¸
	ë¦¬í„´ê°’ì´ Reactë…¸ë“œ
	í•´ë‹¹ contextì˜ provider ì¤‘ ìƒìœ„ íŠ¸ë¦¬ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ providerì˜ value prop
*/}
</MyContext.Consumer>

```

Context.Consumerì˜ ë‚´ë¶€ì— ë“¤ì–´ì˜¤ëŠ” ê°’ë“¤ì€ í•¨ìˆ˜ë¡œ ë“¤ì–´ì™€ì•¼ í•œë‹¤ê³  í•©ë‹ˆë‹¤.    
parameterë¡œëŠ” contextì˜ í˜„ì¬ ê°’ì„ ë°›ìœ¼ë©° ì´ í•¨ìˆ˜ì˜ ë¦¬í„´ê°’ì€ React nodeì…ë‹ˆë‹¤. ( contextê°ì²´ë¥¼ ë°›ìŒ.)      

### Context.displayName

Contextê°ì²´ëŠ” displayName ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.    
ì´ë ‡ê²Œ ì§€ì •í•˜ë©´ devToolsì—ì„œ í™•ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.      
Context ê°ì²´ì— ì €ì¥ì´ ë©ë‹ˆë‹¤.   
![contextAPI02](resources/images/contextAPI02.png)

## ğŸ‘‰ ì˜ˆì‹œë“¤

### ë³€ê²½ê°€ëŠ¥í•œ ê°’(State)ì„ êµ¬ë…í•˜ê¸°

ë³€ê²½ì´ ë  ìˆ˜ ìˆëŠ” ê°’ì„ êµ¬ë…ì‹œí‚¤ë ¤ë©´ Provider ì˜ valueì†ì„±ì— stateê°’ì„ ë„£ìŠµë‹ˆë‹¤.      
(í˜„ì¬ ì˜ˆì‹œì—ì„œëŠ” setState í•¨ìˆ˜ë¥¼ props drillingì„ í†µí•˜ì—¬ ì „ë‹¬í•˜ì˜€ìŠµë‹ˆë‹¤. / App â†’ Toolbar â†’ ThemedButtton)     
Providerë‚´ë¶€ì— ìˆëŠ” buttonì€ themeì´ ë³€ê²½ë  ë•Œ í•¨ê»˜ ë³€ê²½ë˜ì§€ë§Œ ë°”ê¹¥ì— ìˆëŠ” buttonì€ ë³€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.     

```javascript
import { ThemeContext, themes } from "./theme-context";
import ThemedButton from "./themed-button";

// ThemedButtonë¥¼ ì‚¬ìš©í•˜ëŠ” ì¤‘ê°„ì— ìˆëŠ” ì»´í¬ë„ŒíŠ¸
function Toolbar(props) {
  return <ThemedButton onClick={props.changeTheme}>Change Theme</ThemedButton>;
}

class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      theme: themes.light,
    };

    this.toggleTheme = () => {
      this.setState((state) => ({
        theme: state.theme === themes.dark ? themes.light : themes.dark,
      }));
    };
  }

  render() {
    return (
      <Page>
        {" "}
        {/* ThemeProvider ì•ˆì— ìˆëŠ” ThemedButtonì€ stateë¡œë¶€í„° theme ê°’ì„ ì½ì§€ë§Œ */}
        <ThemeContext.Provider value={this.state.theme}>
          <Toolbar changeTheme={this.toggleTheme} />
        </ThemeContext.Provider>
        <Section>
          {" "}
          {/* Provider ë°–ì— ìˆëŠ” ThemedButtonëŠ” ê¸°ë³¸ê°’ì¸ darkë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.*/}
          <ThemedButton />
        </Section>
      </Page>
    );
  }
}

ReactDOM.render(<App />, document.root);
```

### í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ context ì—…ë°ì´íŠ¸í•˜ê¸°

ìœ„ì— ìˆëŠ” ì˜ˆì‹œì—ì„œëŠ” state ë¥¼ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜ë¥¼ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë‚´ë ¤ì£¼ê¸° ìœ„í•´ íŠ¸ë¦¬ë¥¼ ëª¨ë‘ ê±°ì³ ë‚´ë ¤ì¤¬ì—ˆëŠ”ë°

**context ë¥¼ í†µí•´ setState ê°’ë„ í•¨ê»˜ ë‚´ë³´ë‚´ë©´ í¸ë¦¬í•˜ê²Œ ê°’ ë³€ê²½ í•¨ìˆ˜ë„ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

- theme-context.js

```javascript
export const ThemeContext = React.createContext({
  theme: themes.dark,
  toggleTheme: () => {},
});
```

```javascript
import { ThemeContext, themes } from "./theme-context";
import ThemeTogglerButton from "./theme-toggler-button";

class App extends React.Component {
  constructor(props) {
    super(props);

    this.toggleTheme = () => {
      this.setState((state) => ({
        theme: state.theme === themes.dark ? themes.light : themes.dark,
      }));
    };

    // stateì— ì—…ë°ì´íŠ¸ ë©”ì„œë“œë„ í¬í•¨ë˜ì–´ìˆìœ¼ë¯€ë¡œ
    // ì´ ë˜í•œ context Providerë¥¼ í†µí•´ ì „ë‹¬ë  ê²ƒì…ë‹ˆë‹¤.
    this.state = {
      theme: themes.light,
      toggleTheme: this.toggleTheme,
    };
  }

  render() {
    return (
      <ThemeContext.Provider value={this.state}>
        {" "}
        // Providerì— state ì „ì²´ë¥¼ ë„˜ê²¨ì¤ë‹ˆë‹¤.
        <Content />
      </ThemeContext.Provider>
    );
  }
}

function Content() {
  return (
    <div>
      <ThemeTogglerButton />
    </div>
  );
}
```
